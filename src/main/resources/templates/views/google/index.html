<!DOCTYPE html>
<html>
<head>
    <title>Google Drive File Upload</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, button {
            padding: 8px;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .media-container {
            margin-top: 30px;
        }
        .media-item {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .thumbnail {
            max-width: 200px;
            max-height: 150px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Upload Files to Google Drive</h2>
        <div class="form-group">
            <label for="file">Select File:</label>
            <input type="file" id="file" name="file">
        </div>
        <div class="form-group">
            <label for="folderName">Folder Name (optional):</label>
            <input type="text" id="folderName" name="folderName" placeholder="Enter folder name">
        </div>
        <button onclick="uploadFile()">Upload</button>
        
        <div class="form-group" style="margin-top: 20px;">
            <button onclick="loadImages()">Load Images</button>
            <button onclick="loadVideos()">Load Videos</button>
        </div>
        
        <div class="media-container" id="mediaContainer">
            <!-- Media items will be displayed here -->
        </div>
    </div>

    <script>
        function uploadFile() {
            const fileInput = document.getElementById('file');
            const folderName = document.getElementById('folderName').value;
            
            if (!fileInput.files[0]) {
                alert('Please select a file to upload');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            if (folderName) {
                formData.append('folderName', folderName);
            }
            
            fetch('/api/drive/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(url => {
                alert('File uploaded successfully. URL: ' + url);
                // Reload media based on file type
                if (fileInput.files[0].type.includes('image')) {
                    loadImages();
                } else if (fileInput.files[0].type.includes('video')) {
                    loadVideos();
                }
            })
            .catch(error => {
                alert('Upload failed: ' + error);
            });
        }
        
        function loadImages() {
            loadMedia('image');
        }
        
        function loadVideos() {
            loadMedia('video');
        }
        
        function loadMedia(type) {
            fetch(`/api/drive/list/${type}`)
            .then(response => response.json())
            .then(files => {
                const container = document.getElementById('mediaContainer');
                container.innerHTML = ''; // Clear existing content
                
                if (files.length === 0) {
                    container.innerHTML = `<p>No ${type}s found</p>`;
                    return;
                }
                
                files.forEach(file => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item';
                    
                    // Create thumbnail or preview
                    let mediaPreview = '';
                    if (type === 'image') {
                        if (file.thumbnailLink) {
                            mediaPreview = `<img src="${file.thumbnailLink}" class="thumbnail" alt="${file.name}">`;
                        }
                    } else if (type === 'video') {
                        if (file.thumbnailLink) {
                            mediaPreview = `<img src="${file.thumbnailLink}" class="thumbnail" alt="${file.name}">`;
                        } else {
                            mediaPreview = '<div class="thumbnail">Video Preview Not Available</div>';
                        }
                    }
                    
                    mediaItem.innerHTML = `
                        ${mediaPreview}
                        <div>
                            <p><strong>${file.name}</strong></p>
                            <p><a href="${file.webViewLink}" target="_blank">View in Google Drive</a></p>
                            <button onclick="deleteFile('${file.id}')">Delete</button>
                        </div>
                    `;
                    
                    container.appendChild(mediaItem);
                });
            })
            .catch(error => {
                console.error('Error loading media:', error);
                document.getElementById('mediaContainer').innerHTML = `<p>Error loading ${type}s</p>`;
            });
        }
        
        function deleteFile(fileId) {
            if (confirm('Are you sure you want to delete this file?')) {
                fetch(`/api/drive/delete/${fileId}`, {
                    method: 'DELETE'
                })
                .then(response => response.text())
                .then(result => {
                    alert(result);
                    // Reload media
                    loadImages();
                    loadVideos();
                })
                .catch(error => {
                    alert('Delete failed: ' + error);
                });
            }
        }
    </script>
</body>
</html>
